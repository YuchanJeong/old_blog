---
title: "BC-14w-4 / {FC} GraphQL ë§›ë³´ê¸°"
date: 2021-12-30
categories:
  - <Bootcamp>
tags:
  - GraphQL
---

## 1. Rest API & [GraphQL](https://graphql.org/)

### Rest API

```js
axios.get("https://api.marktube.tv/v1/book", { headers: `Bearer ${token}` });

axios.post(
  "https://api.marktube.tv/v1/book",
  {
    title,
    message,
    author,
    url,
  },
  { headers: `Bearer ${token}` }
);

axios.get(`https://api.marktube.tv/v1/book/${book.id}`, {
  headers: `Bearer ${token}`,
});

axios.patch(
  `https://api.marktube.tv/v1/book/${book.id}`,
  {
    title,
    message,
    author,
    url,
  },
  { headers: `Bearer ${token}` }
);

axios.delete(`https://api.marktube.tv/v1/book/${book.id}`, {
  headers: `Bearer ${token}`,
});
```

- urlì˜ í˜•íƒœì™€ ë©”ì†Œë“œì˜ ì¡°í•©ìœ¼ë¡œ íŠ¹ì • ë¦¬ì†ŒìŠ¤ì˜ ì¡°íšŒ, ìˆ˜ì •, ì‚­ì œ ë“±ì„ í•¨
- ê²°ê³¼ë¬¼ì„ ì™„ì „íˆ ì˜ë„ ë°ë¡œ ê°€ì ¸ì˜¤ê¸° í˜ë“  ê²½ìš°ê°€ ìˆìŒ
- ë¶ˆí•„ìš”í•˜ê²Œ ì—¬ëŸ¬ ë²ˆ ìš”ì²­í•´ì•¼ í•˜ëŠ” ê²½ìš°ê°€ ìˆìŒ
- ì¡°íšŒí•œ ë°ì´í„°ê°€ ë¶ˆí•„ìš”í•œ ë‚´ìš©ì„ í¬í•¨í•´ì„œ ìš©ëŸ‰ì´ ì»¤ì§€ëŠ” ê²½ìš°ê°€ ìˆìŒ

### GraphQL

- ì¿¼ë¦¬ë¥¼ ë³´ë‚´ì„œ ê²°ê³¼ë¡œ ì›í•˜ëŠ” ë°ì´í„°ë§Œ ì‚¬ìš©
- CODE -> JavaScript -> Apollo Server

## 2. Apollo [\*](https://www.apollographql.com/docs/apollo-server/) [\*\*](https://github.com/apollographql/apollo-server)

```bash
# GraphQLì˜ Apollo server ì‹œì‘
npm init -y
npm i apollo-server@3 graphql@15
# ìˆ˜ì •ì‹œ ìë™ìœ¼ë¡œ ì„œë²„ ìƒˆë¡œê³ ì¹¨í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬
npm i nodemon@2 -D
```

## 3. typeDef & resolver

### A. typeDef(s)

- GraphQL Schemaë¥¼ ì •ì˜í•˜ëŠ” ê³³
  - Object
  - Query
  - Mutation
  - Input
- gqlê³¼ Tagged Template Literalsë¡œ ì‘ì„±

### B. resolver(s)

- Schemaì— í•´ë‹¹í•˜ëŠ” êµ¬í˜„ì„ í•˜ëŠ” ê³³
- ìš”ì²­ì„ ë°›ì•„ ë°ì´í„°ë¥¼ ì¡°íšŒ, ìˆ˜ì •, ì‚­ì œ

## 4. ì¡°íšŒ, ì¶”ê°€, ìˆ˜ì •, ì‚­ì œ

```js
// index.js
const { ApolloServer, gql } = require("apollo-server");
const { readFileSync, writeFileSync } = require("fs");
const { join } = require("path");

// The GraphQL schema
const typeDefs = gql`
  type Query {
    books: [Book]

    book(bookId: Int): Book
  }

  type Mutation {
    addBook(title: String, message: String, author: String, url: String): Book

    editBook(
      bookId: Int
      title: String
      message: String
      author: String
      url: String
    ): Book

    deleteBook(bookId: Int): Book
  }

  type Book {
    bookId: Int
    title: String
    message: String
    author: String
    url: String
  }
`;

// A map of functions which return data for the schema.
const resolvers = {
  Query: {
    books: () => {
      return JSON.parse(readFileSync(join(__dirname, "books.json")).toString());
    },
    book: (parent, args, context, info) => {
      const books = JSON.parse(
        readFileSync(join(__dirname, "books.json")).toString()
      );
      return books.find((book) => book.bookId === args.bookId);
    },
  },

  Mutation: {
    addBook: (parent, args, context, info) => {
      const books = JSON.parse(
        readFileSync(join(__dirname, "books.json")).toString()
      );
      const maxId = Math.max(...books.map((book) => book.bookId));
      const newBook = { ...args, bookId: maxId + 1 };
      writeFileSync(
        join(__dirname, "books.json"),
        JSON.stringify([...books, newBook])
      );
      return newBook;
    },

    editBook: (parent, args, context, info) => {
      const books = JSON.parse(
        readFileSync(join(__dirname, "books.json")).toString()
      );
      const newBooks = books.map((book) => {
        if (book.bookId === args.bookId) {
          return args;
        } else {
          return book;
        }
      });
      writeFileSync(join(__dirname, "books.json"), JSON.stringify(newBooks));
      return args;
    },

    deleteBook: (parent, args, context, info) => {
      const books = JSON.parse(
        readFileSync(join(__dirname, "books.json")).toString()
      );
      const deletedBook = books.find((book) => book.bookId === args.bookId);
      const newBooks = books.filter((book) => book.bookId !== args.bookId);
      writeFileSync(join(__dirname, "books.json"), JSON.stringify(newBooks));
      return deletedBook;
    },
  },
};

const server = new ApolloServer({
  typeDefs,
  resolvers,
});

server.listen().then(({ url }) => {
  console.log(`ğŸš€ Server ready at ${url}`);
});
```

```json
// books.json
[
  {
    "bookId": 1,
    "title": "title1",
    "message": "message1",
    "author": "author1",
    "url": "url1"
  },
  {
    "bookId": 2,
    "title": "title2",
    "message": "message2",
    "author": "author2",
    "url": "url2"
  }
]
```

```bash
query {
  books {
    bookId
    title
    message
    author
    url
  }

  book(bookId: 1) {
    bookId
    title
    message
    author
    url
  }
}

mutation {
  addBook(
    title: "ì œëª©",
    message: "ë‚´ìš©",
    author: "ì €ì",
    url: "ìœ„ì¹˜"
  ) {
    bookId
    title
    message
    author
    url
  }

  editBook(
    bookId: 3,
    title: "ì œëª©edit",
    message: "ë‚´ìš©edit",
    author: "ì €ìedit",
    url: "ìœ„ì¹˜edit"
  ) {
    bookId
    title
    message
    author
    url
  }

  deleteBook(
    bookId: 3)
  {
    bookId
    title
    message
    author
    url
  }
}
```
