---
title: "[Debate-Ducks] 정적 배포 및 마이페이지 개선"
date: 2022-08-23
categories:
  - <Projects>
tags:
  - "'Debate-Ducks'"
  - (Devlog)
---

<!-- 고민 vercel과 EC2를 같이 쓸 때 속도 저하의 문제가 발생.

현재 서버 담당자의 AWS에서 서버 EC2를 사용중이라 내 EC2에 클라이언트를 배포하는 방법도 있으나 서버 담당자가 내켜하지 않음

하지만 동적 데이터와 함께 s3를 쓰려면 동적 라우팅을 버리고 쿼리로 페이지를 대신 해야함. 여기서 추가 고민 이럴꺼면 그냥 리액트로 다시 전환할까? 그러다 이왕 Next.js 쓴거 기본 기능만 이용하지 말고 좀 더 최적화를 해보자!

메모리 부족 / 서버 버셀은 안되

https://velog.io/@daeseongkim/%EA%B3%B5%EA%B0%90%EB%B3%91%EB%8F%99-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EB%9E%9C%EB%8D%94%EB%A7%81-%EC%86%8D%EB%8F%84-%EA%B0%9C%EC%84%A0

https://velog.io/@sj_dev_js/Next.js-%EB%8F%99%EC%A0%81-%EB%9D%BC%EC%9A%B0%ED%8C%85%EB%90%9C-%ED%8E%98%EC%9D%B4%EC%A7%80-%EB%B0%B0%ED%8F%AC%EC%8B%9C-404-%EC%97%90%EB%9F%AC

파일 쪼개는거 git LFS vkdlfaud gkskgk (https://wooono.tistory.com/284)

https://cottonwood-moa.tistory.com/136

https://nextjs.org/docs/basic-features/data-fetching/incremental-static-regeneration

https://vroomfan.tistory.com/4

https://merrily-code.tistory.com/173

https://velog.io/@real-bird/Next.js-ISR

https://kdinner.tistory.com/120 -->

## 회원가입, 로그인 및 마이페이지 개선

![MyPage](https://user-images.githubusercontent.com/84524514/186295479-430b0c9b-c2d0-4af0-94b9-c4f767d20cf4.gif)

### 회원가입 및 로그인 페이지 짤림 문제

회원가입 페이지와 로그인 페이지에서 창의 세로 길이가 줄어들었을 경우 잘림 현상과 함께 드래그도 할 수 없는 문제를 발견했다. 원인은 `outer`를 화면에 고정된 요소로 만들어 뒀기 때문이었다. 그래서 해당 부분을 제거해서 잘림 현상을 해결했다.

그리고 align-items를 flex-start로 만들어 위로 튀어나옴 문제를 해결했다. 또한 `outer`에 padding을 주고 내부의 `container`에는 margin을 줘서 경계에 너무 붙지 않게 만들었다.

- 변경 전 (회원가입)
  <img width="700" alt="회원가입 페이지 짤림" src="https://user-images.githubusercontent.com/84524514/186260562-d3ae9e1e-cc8e-4d8f-bc38-d5d51199a1f2.png">

- 변경 후 (회원가입)
  <img width="600" alt="회원가입 페이지 해결" src="https://user-images.githubusercontent.com/84524514/186261989-818e2329-b3ec-42c8-bfbe-c506c8a4698d.png">

- 기존 스타일 (회원가입)
  ```scss
  .outer {
    width: 100%;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: -1;
  }
  ```
- 변경 후 스타일 (회원가입)
  ```scss
  .outer {
    width: 100%;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    padding: 1rem;
    z-index: -1;
    min-width: 22rem;
  }
  .container {
    margin: 2rem;
  }
  ```

### 비로그인 시 마이페이지 렌더링

기존 마이페이지는 사용자 정보가 없을 때 제대로 처리하지 못하는 문제가 있었다. 처음에는 사용자 정보가 없을 때 에러 페이지를 렌더링 했으나 페이지 이동 혹은 로그아웃 시 깜박이듯 에러 화면이 노출되는 것이 마음에 들지 않았다. 그래서 사용자 정보가 없을 때 기본 이미지와 함께 로그인 버튼을 보여 주는 것으로 변경했다.

- 기존 마이페이지 (비로그인 시)
  <img width="800" alt="스크린샷 2022-08-24 오전 6 41 46" src="https://user-images.githubusercontent.com/84524514/186291142-e5607de2-28f3-4302-9609-328eb4262cd4.png">
- 개선 마이페이지 (비로그인 시)
  <img width="700" alt="스크린샷 2022-08-24 오전 7 08 50" src="https://user-images.githubusercontent.com/84524514/186291169-21549078-dedf-4d90-bdef-3c12fec5aace.png">

### createObjectURL 에러 해결

<img width="1200" alt="프로필 이미지 변경 문제" src="https://user-images.githubusercontent.com/84524514/185069278-5bf399fa-bc74-43f4-ba8e-0c9494ff48ff.png">

사용자 프로필 이미지 수정 후 저장하지 않고 파일 업로드 도달에서 취소를 누르면 에러가 발생했다. 적절한 타입이 아닌 데이터가 들어갈 경우 나는 에러로 `handleChangeImage`에 조건을 걸어서 걸러주는 것으로 해결했다. 추가로 `revokeObjectURL`를 사용해 메모리 누수를 막았다.

```ts
const handleChangeImage = (e: BaseSyntheticEvent) => {
  if (!e.target.files[0]) return;
  setImage(e.target.files[0]);
  setPreviewImageUrl(window.URL.createObjectURL(e.target.files[0]));
};
```

```ts
const handleImageSave = () => {
  if (user.data) {
    ...
    window.URL.revokeObjectURL(previewImageUrl);
  }
};
```

Ps. 추가로 이미지를 변경한 이후 다시 취소할 수 있게 버튼을 만들었다.
<img width="700" alt="스크린샷 2022-08-24 오전 7 56 45" src="https://user-images.githubusercontent.com/84524514/186291212-bb1c8ab9-66aa-4f69-bda7-155e9ff7dc80.png">

### 기타 문제 해결

- 회원가입, 로그인 및 마이페이지 최소 넓이 설정
- 마이페이지 placeholder 색상 회색으로 변경 (구분 용의)
- 회원가입 및 마이페이지 이름 유효성 검사 개선 (낱자를 뺀 한글, 영어, 숫자)
