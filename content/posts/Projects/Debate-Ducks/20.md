---
title: "[Debate-Ducks] 실시간 영상 토론방"
date: 2022-08-07
categories:
  - <Projects>
tags:
  - "'Debate-Ducks'"
  - (Devlog)
---

## 실시간 영상 토론방 에러 해결 및 스타일 적용

내가 프로젝트에서 가장 먼저 한 작업이 실시간 영상 토론이다. 이 기능을 완성한 다음 다른 기능들을 작업하고, 기능 작업의 역순으로 스타일 적용을 하면서 기능의 개선도 함께 진행했다.

기능을 완성한 다음 추가 작업을 한 적이 없는데, 스타일 적용을 위해 실시간 토론 기능을 확인하자 WebRTC 연결 에러가 발생했다.

<img width="250" alt="에러1" src="https://user-images.githubusercontent.com/84524514/184471930-28db1eba-3178-4f50-a0aa-c5bc093e7867.png">

<img width="250" alt="에러2" src="https://user-images.githubusercontent.com/84524514/184471916-df6069a5-6480-4110-9819-8678c6d8dbce.png">

변경 사항이 없는데 갑자기 에러가 발생해서 매우 당황스러웠다. 이 때문에 실책을 하나 했다. 이미 기능이 너무 복잡해서 어디서 문제가 발생했는지 확인이 어렵다고 생각해 실시간 토론 기능을 우선 모두 삭제하고 다시 하나씩 확인하면서 재작업을 진행했다. (하지만 콘솔을 먼저 찍어봤으면 삭제 후 재작업 없이 확인이 가능했다. 🥲🥲🥲)

재작업 과정에서 콘솔을 하나하나 찍으면서 확인했고, 우선 연결이 두 번씩 진행되고 있는 문제를 발견했다.

<img width="180" alt="연결 두번 됨 1" src="https://user-images.githubusercontent.com/84524514/184474260-cb6407f9-d121-457c-9c77-e77e573409c0.png">

<img width="230" alt="연결 두번 됨 2" src="https://user-images.githubusercontent.com/84524514/184474276-73b07776-f5c3-4bde-8fdc-a6d005a83d11.png">

이 문제는 서버 측의 socket.io 입장 이벤트 조건을 추가하는 것으로 쉽게 해결했다.

```ts
if (roomSize < 2 && !roomId[socket.id]) {
  roomId[socket.id] = data.debateId;
  ...
} else if (roomId[socket.id]) {
} else {
  socket.emit("overcapacity");
}
```

다음으로 연결 해제를 확인했는데, 페이지를 벗어났음에도 가끔씩 disconnect 콘솔이 찍히지 않는 것을 확인했다. 언제 찍히지 않는지를 확인 해보자 페이지의 이동이 App 내부에서 일어났을 경우에만 disconnect 이벤트가 발생하지 않았다.

위의 두 번씩 진행되는 연결 문제를 이전에 발견하지 못한 것도, 현재 발생하는 WebRTC 연결 문제도 이 같은 이유였다.

이전에 작업할 때는 실시간 영상 토론 페이지밖에 없어서 뒤로 가기와 앞으로 가기를 테스트를 할 때, App 외부에서 App 내부로만 이동이 있었고, router 버튼도 만들어져있지 않아 주소를 통해 직접 이동했기 때문에 이 문제를 발견하지 못한 것이었다.

이를 깨닫고 삭제했던 실시간 토론 기능을 `git revert` 했다.
