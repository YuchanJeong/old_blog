---
title: "[Debate-Ducks] Debateroom - ???"
date: 2022-07-23
categories:
  - <Projects>
tags:
  - "'Debate-Ducks'"
  - (Devlog)
draft: true
---

## Summary

기존에 요청 수에 대한 고민을 많이했음.

이전에는 POST, PATCH, DELETE 후 쿼리를 invalid로 만드는 것으로 자동 업데이트 시켰으나 그럴 경우 GET 요청이 다시 가버리는 문제 발생. 이를 방지하고 싶어서...

그래서 내부 로직에서 업데이트 시켜주는거로 만듦.

편집은 초깃값 조회 때문에 SSR 필요.

게시물에서는 userId를 SSR에 넣지 못해서 좋아요 정보가 항상 false로 나옴.

그래서 SSR 없엤는데 undefined일때 조회를 시도하고 또한 여러번 재렌더링을 시도해서 차라리 heart를 빼는게 나을꺼라 생각

프리렌더링에서 stale을 false로 하면 해결 되지만 그러면 결국 두번 요청하는거랑 같은거

거기다 젤 문제는 undefined인 값이 쿼리에 들어간다는 것!

---

투표도 포스트인지 패치인지 구분하려고 하니까 투표를 이미 했는지 안했는지 받아야 해서 결국 요청을 토론에만 담는게 의미가 없었음.

조인된 데이터를 가지고 올 수 없어서

그래서 따로 유저아이디를 보내서 찾는 방법은 가능

하지만 그러려면 사전렌더링을 쓰고 0 에러방지 그리고 바로 stale로 만들어서 직접 받게 만들어야함. 사실상의 사전 렌더링은 포기하게 되는 것.

목록을 가지고 와서 클라에서 비교하는 것도 갯수만 보여주면 되는 입장에서 비효율 적인 방식이라 생각

현재는 일단 요청을 각각 보내는 방식으로 결정 추후 충분히 개선이나 수정이 가능한 부분이라 생각

그리고 onMutate에 지정한 함수에서 리턴한 값이 onError와 onSettled로 전해진다고 한다!

```js
console.log(
  "##############",
  lastPage,
  query.page,
  typeof query.page,
  skip_flag,
  lastPage === query.page
);
```

```bash
############## 6 6 string 60 false
```

useEffect(() => {
if (inView && comments.hasNextPage) comments.fetchNextPage();
}, [comments, inView]);

공백과 개행과 등등
\s가 개행도 포함해서 이거 어캐하누
해결!!!

---

이거 정렬할떄 문제가 좀 있네

const orderSelect = useSelect(COMMENT_ORDER[0], refetch);

const comments = useGetComments(
debateId,
orderSelect.value === "최신순" ? "ASC" : "DESC",
);

function refetch() {
console.log(orderSelect.value);
comments.refetch();
}

한박자 늦음

export const useSelect = (
initialValue: string,
callback?: () => void,
): UseSelectResult => {
const [value, setValue] = useState(initialValue);

const onChange = (ev: ChangeEvent<HTMLSelectElement>) => {
if (ev.target.value !== value) {
setValue(ev.target.value);
if (callback) callback();
}
};

return {
attribute: { value, onChange },
value,
setValue,
};
};

function refetch() {
setTimeout(() => comments.refetch(), 1);
}
